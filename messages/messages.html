<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script>

           
            const directMessages = [{id: 01, name: "Sherlock Homes",numUndreadMessages:10, messages:[{isMyMessage: true,content: "hi"}, {isMyMessage: false,content: "goodevening" }]},
                            {id: 02,name: "Jim Moriarty",numUndreadMessages:0, messages:[{isMyMessage:true, content:"i need help"}]}];

            $(document).ready(function(){

                listDirectContacts();

                $(document).on('keypress',function(e) {
                if(e.which == 13) {
                    let message = $("#messageInput").val();
                    $("#messageInput").val('');
                    sendMessage(message);
                }
                });
            });

            //send entered message to the recipant
            function sendMessage(message){
                if(message != ""){
                    addMessage(message, true);
                    //insert ajax
                }
            }  
            //CHATBOX FUNCTIONS
            //add a message to the chat box
            function addMessage(message, isMyMessage){
                let html = ""
                if(isMyMessage){
                    html += "<div class = 'd-flex justify-content-end'>\
                    <span class = 'myMessage rounded-pill p-3'>" + message +"</span>"
                }
                else{
                    html += "<div class = 'd-flex justify-content-start'>\
                    <span class = 'thierMessage rounded-pill p-3'>" + message +"</span>"
                }
                html += "\<div>"
                $("#chatbox").append(html)
            }
            //clear chatbox
            function clearChatbox(){
                $("#chatbox").empty();
            }
            //SIDEBAR FUNCTIONS
            //clear contacts
            function clearContacts(){
                $("#contactsList").empty();
            };
            //load the lsit of direct messages
            function listDirectContacts(){
                clearContacts();    
                for(let i = 0; i < directMessages.length; i++  ){
                    appendContact(directMessages[i]);
                }
                
            }
            //append one contact to the side bar 
            function appendContact(contact){
                //console.log(contact);
                let html = "<button id = 'direct_contact_" + contact.id + "' class='list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3' onclick = 'switchChat(this)'>\
                            <div class='ms-2 me-auto'>\
                                <div class='fw-bold'>" +
                                    contact.name +
                                "</div>\
                            </div>";
                            if (contact.numUndreadMessages != 0){
                              html += "<span class='badge bg-primary rounded-pill'>" + contact.numUndreadMessages + "</span>"
                            }
                html += "</button>";
                $("#contactsList").append(html);
            }

            //load the list of groups
            function listGroupContacts(){
                clearContacts();
            }
            //clear chat and list new messages 
            function switchChat(button){
                clearChatbox();
                let id = button.id.replace("direct_contact_", "");

                for(let i = 0; i < directMessages.length; i++){
                    if(id == directMessages[i].id){
                        listMessages(directMessages[i].messages,true);
                    }
                }
            }
            //iterate over mesages and add them
            function listMessages(messages, isDirect){
                for(let i = 0; i < messages.length; i++){
                    //TODO check if direct message or group message - add name to if group
                    addMessage(messages[i].content, messages[i].isMyMessage);
                }
            }






        </script>

        <style>
            .container-fluid{
                padding: 0 !important;
            }
            .header{
                background-color: rgb(62, 0, 103);
            }
            h1{
                color:white;
            }
            .chatborder{
                background-color: rgb(62, 0, 103);
                border: white;
            }
            #messages{
                overflow-x: hidden !important;
                overflow-y: auto;
                background-color: white;
            }
            .myMessage{
                background-color: lightblue;
                align-self: self-end;
            }
            .thierMessage{
                background-color: grey;
            }
            .message{
                max-width: 60%;
            }
            #chat_title{
                background-color: rgb(62, 0, 103);
                color: white;
            }
        </style>
    </head>
    
    <body class = "d-flex flex-column h-100" style = "background-color: white;">
        <header class = "header px-4 py-1 text-center">
            <h1> Message Subsystem </h1>
        </header>
        <div class="container-fluid d-flex flex-grow-1">
            <div class="row flex-grow-1 flex-column flex-sm-row g-0">
                <!-- chat selection-->
                <div class="col-sm-3 sidebar flex-shrink-1">
                    <div class="">
                        <!-- group and direct buttons-->
                        <div class="d-flex bd-highlight">
                            <div class="flex-fill bd-highlight text-center">
                                <button class="btn border border-white btn-primary rounded-0 w-100" onclick= "listDirectContacts()">
                                    Direct
                                </button>
                            </div>
                            <div class="flex-fill bd-highlight text-center">
                                <button class="btn border border-white btn-primary rounded-0 w-100" onclick= "listGroupContacts()">
                                    Group
                                </button>
                            </div>
                        </div>
                        <!-- list of chats-->
                        <div class = "text-center">
                        <div id = "contactsList" class="list-group rounded-0">
                        </div>
                        <button class="btn btn-success rounded-0 w-100">+</button>
                        </div>
                    </div>
                </div>
                <!-- chat -->
                <div id = "messages" class="col-sm-9 d-flex flex-column  pb-2">
                    <div  id = "chat_title" class = " border-top border-white text-center p-3">NAME GOES HERE</div>
                    <div id = "chatbox" class = "d-flex flex-column">
                        
                    </div>
                    <!-- message input-->
                    <div class = "row p-3 m" style = "margin-top:auto">
                        <input type="text" id ="messageInput" class = "p-3 m-0 rounded-2" placeholder="enter Message">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>